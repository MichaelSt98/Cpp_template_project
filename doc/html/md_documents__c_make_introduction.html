<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.8.20"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>Cpp concept project: CMake</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen-custom.css" rel="stylesheet" type="text/css" />
	<!-- Add icon library -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Add font awesome icons -->
</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				API Documentation for CMake
			</span>
			<!-- <span class="search">
				<input type="text" placeholder="Search" onkeydown="search(this,event);">
			</span> -->
		</div>
	<div class="icon-bar">
		<a href="https://de-de.facebook.com/" class="fa fa-facebook"></a>
		<a href="https://twitter.com/?lang=de" class="fa fa-twitter"></a>
		<a href="https://github.com/" class="fa fa-github"></a>
		<a href="https://www.youtube.com/?gl=DE&hl=de" class="fa fa-youtube"></a>
		<a href="https://www.linkedin.com/login/de" class="fa fa-linkedin"></a>
		<a href="https://about.gitlab.com/?utm_medium=cpc&utm_source=google&utm_campaign=brand_emea_pr_rsa_br_exact&utm_content=homepage_digital_x-pr_english_&_bt=363211725518&_bk=gitlab&_bm=e&_bn=g&_bg=75294586319&gclid=EAIaIQobChMI1rKi_ICR7QIVV53VCh2igg88EAAYASAAEgKcFPD_BwE" class="fa fa-gitlab"></a>
		<a href="https://uni-tuebingen.de/" class="fa fa-university"></a>
		<a href="https://slack.com/intl/de-de/" class="fa fa-slack"></a>
		<a href="#" class="fa fa-share-alt"></a>
		<a href="https://de.wikipedia.org/wiki/Wikipedia:Hauptseite" class="fa fa-wikipedia-w"></a>
	</div>
	</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CMake </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md10"></a>
Links</h1>
<ul>
<li><a href="https://gitlab.kitware.com/cmake/cmake">Repository</a></li>
<li><a href="https://github.com/onqtam/awesome-cmake">Awesome-CMake list</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Documentation</h2>
<ul>
<li><a href="https://cmake.org/cmake/help/v3.19/">CMake official documentation</a></li>
<li><a href="http://www.aosabook.org/en/cmake.html">The Architecture of Open Source Applications</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Tutorials &amp; Instructions</h2>
<ul>
<li><a href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1">Effective Modern CMake (Dos &amp; Don'ts)</a></li>
<li><a href="https://cliutils.gitlab.io/modern-cmake/">GitBook: Introduction to Modern CMake</a></li>
<li><a href="https://github.com/dev-cafe/cmake-cookbook">CMake Cookbook</a></li>
<li><a href="https://llvm.org/docs/CMakePrimer.html">CMake Primer</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Videos</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=HPMvU64RUTY">Intro to CMake</a></li>
<li><a href="https://www.youtube.com/watch?v=eC9-iRN2b04">Using Modern CMake Patterns to Enforce a Good Modular Design</a></li>
<li><a href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">Effective CMake</a></li>
<li><a href="https://www.youtube.com/watch?v=JsjI5xr1jxM">Embracing Modern CMake</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Basics</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
CMake Version</h2>
<div class="fragment"><div class="line">#minmum CMake version</div>
<div class="line">cmake_minimum_required(VERSION 3.12)</div>
<div class="line">if(${CMAKE_VERSION} VERSION_LESS 3.12)</div>
<div class="line">    cmake_policy(VERSION ${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION})</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
VARIABLES</h2>
<div class="fragment"><div class="line"># Local variable</div>
<div class="line">set(MY_VARIABLE &quot;value&quot;)</div>
<div class="line">set(MY_LIST &quot;one&quot; &quot;two&quot;)</div>
<div class="line"># Cache variable</div>
<div class="line">set(MY_CACHE_VARIABLE &quot;VALUE&quot; CACHE STRING &quot;Description&quot;)</div>
<div class="line"># Environmental variables</div>
<div class="line">set(ENV{variable_name} value) #access via $ENV{variable_name}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
PROPERTIES</h2>
<div class="fragment"><div class="line">set_property(TARGET TargetName PROPERTY CXX_STANDARD 11)</div>
<div class="line">set_target_properties(TargetName PROPERTIES CXX_STANDARD 11)</div>
<div class="line">get_property(ResultVariable TARGET TargetName PROPERTY CXX_STANDARD)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Output folders</h2>
<div class="fragment"><div class="line"># set output folders</div>
<div class="line">set(PROJECT_SOURCE_DIR)</div>
<div class="line">set(CMAKE_SOURCE_DIR ...)</div>
<div class="line">set(CMAKE_BINARY_DIR ${CMAKE_SOURCE_DIR}$/bin)</div>
<div class="line">set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR})</div>
<div class="line">set(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Sources</h2>
<div class="fragment"><div class="line"># set sources</div>
<div class="line">set(SOURCES example.cu)</div>
<div class="line">file(GLOB SOURCES *.cu)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Executables &amp; targets</h2>
<p>Add executable/create target:</p>
<div class="fragment"><div class="line">#add_executable(example ${PROJECT_SOURCE_DIR}/example.cu)</div>
<div class="line">add_executable(miluphcuda ${SOURCES})</div>
</div><!-- fragment --><div class="fragment"><div class="line"># add include directory to target</div>
<div class="line">target_include_directories(miluphcdua PUBLIC include) #PUBLIC/PRIVATE/INTERFACE</div>
<div class="line"># add compile feature to target</div>
<div class="line">target_compile_features(miluphcuda PUBLIC cxx_std_11)</div>
</div><!-- fragment --><div class="fragment"><div class="line"># chain targets (assume &quot;another&quot; is a target)</div>
<div class="line">add_library(another STATIC another.cpp another.h)</div>
<div class="line">target_link_libraries(another PUBLIC miluphcuda)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
PROGRAMMING IN CMAKE</h2>
<p>Keywords:</p>
<ul>
<li>NOT</li>
<li>TARGET</li>
<li>EXISTS</li>
<li>DEFINED</li>
<li>STREQUAL</li>
<li>AND</li>
<li>OR</li>
<li>MATCHES</li>
<li>...</li>
</ul>
<h3><a class="anchor" id="autotoc_md22"></a>
Control flow</h3>
<div class="fragment"><div class="line">if(variable)</div>
<div class="line">    # If variable is `ON`, `YES`, `TRUE`, `Y`, or non zero number</div>
<div class="line">else()</div>
<div class="line">    # If variable is `0`, `OFF`, `NO`, `FALSE`, `N`, `IGNORE`, `NOTFOUND`, `&quot;&quot;`, or ends in `-NOTFOUND`</div>
<div class="line">#endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md23"></a>
Loops</h3>
<ul>
<li><code>foreach(var IN ITEMS foo bar baz) ...</code></li>
<li><code>foreach(var IN LISTS my_list) ...</code></li>
<li>`<code>foreach(var IN LISTS my_list ITEMS foo bar baz) ...</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md24"></a>
Generator expression</h3>
<div class="fragment"><div class="line">target_include_directories(</div>
<div class="line">        MyTarget</div>
<div class="line">        PUBLIC</div>
<div class="line">        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include&gt;</div>
<div class="line">        $&lt;INSTALL_INTERFACE:include&gt;</div>
<div class="line">)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md25"></a>
Functions (&amp; macros)</h3>
<div class="fragment"><div class="line">function(SIMPLE REQUIRED_ARG)</div>
<div class="line">    message(STATUS &quot;Simple arguments: ${REQUIRED_ARG}, followed by ${ARGV}&quot;)</div>
<div class="line">    set(${REQUIRED_ARG} &quot;From SIMPLE&quot; PARENT_SCOPE)</div>
<div class="line">endfunction()</div>
<div class="line">simple(This)</div>
<div class="line">message(&quot;Output: ${This}&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
COMMUNICATION WITH CODE</h2>
<h3><a class="anchor" id="autotoc_md27"></a>
Configure File</h3>
<div class="fragment"><div class="line">configure_file()</div>
<div class="line">...</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md28"></a>
Reading files</h3>
<div class="fragment"><div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
RUNNING OTHER PROGRAMS</h2>
<h3><a class="anchor" id="autotoc_md30"></a>
command at configure time</h3>
<div class="fragment"><div class="line">find_package(Git QUIET)</div>
<div class="line">if(GIT_FOUND AND EXISTS &quot;${PROJECT_SOURCE_DIR}/.git&quot;)</div>
<div class="line">    execute_process(COMMAND ${GIT_EXECUTABLE} submodule update --init --recursive</div>
<div class="line">            WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}</div>
<div class="line">            RESULT_VARIABLE GIT_SUBMOD_RESULT)</div>
<div class="line">    if(NOT GIT_SUBMOD_RESULT EQUAL &quot;0&quot;)</div>
<div class="line">        message(FATAL_ERROR &quot;git submodule update --init failed with ${GIT_SUBMOD_RESULT}, please checkout submodules&quot;)</div>
<div class="line">    endif()</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31"></a>
command at build time</h3>
<div class="fragment"><div class="line">find_package(PythonInterp REQUIRED)</div>
<div class="line">add_custom_command(OUTPUT &quot;${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp&quot;</div>
<div class="line">        COMMAND &quot;${PYTHON_EXECUTABLE}&quot; &quot;${CMAKE_CURRENT_SOURCE_DIR}/scripts/GenerateHeader.py&quot; --argument</div>
<div class="line">        DEPENDS some_target)</div>
<div class="line">add_custom_target(generate_header ALL</div>
<div class="line">        DEPENDS &quot;${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp&quot;)</div>
<div class="line">install(FILES ${CMAKE_CURRENT_BINARY_DIR}/include/Generated.hpp DESTINATION include)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md32"></a>
Libraries</h1>
<div class="fragment"><div class="line"># make a library</div>
<div class="line">add_library(one STATIC two.cpp three.h) # STATIC/SHARED/MODULE</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md33"></a>
Language/Package related</h1>
<h2><a class="anchor" id="autotoc_md34"></a>
C</h2>
<div class="fragment"><div class="line"># set C compiler</div>
<div class="line">set(CMAKE_C_COMPILER &quot;/usr/bin/gcc-7&quot;)</div>
<div class="line">execute_process (</div>
<div class="line">        COMMAND bash -c &quot;git describe --abbrev=4 --dirty --always --tags&#39;&quot;</div>
<div class="line">        OUTPUT_VARIABLE GIT_VERSION</div>
<div class="line">)</div>
</div><!-- fragment --><div class="fragment"><div class="line">#set(CMAKE_BUILD_TYPE DEBUG)</div>
<div class="line">set(CMAKE_C_FLAGS &quot;-c -std=c99 -O3 -DVERSION=\&quot;${GIT_VERSION})\&quot; -fPIC&quot;)</div>
<div class="line">#set(CMAKE_C_FLAGS_DEBUG &quot;-O0 -ggdb&quot;)</div>
<div class="line">#set(CMAKE_C_FLAGS_RELEASE &quot;-O0 -ggdb&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md35"></a>
C++</h2>
<p>...</p>
<h2><a class="anchor" id="autotoc_md36"></a>
CUDA</h2>
<p>See <a href="https://on-demand.gputechconf.com/gtc/2017/presentation/S7438-robert-maynard-build-systems-combining-cuda-and-machine-learning.pdf">Combining CUDA and Modern CMake</a></p>
<h3><a class="anchor" id="autotoc_md37"></a>
Enable Cuda support</h3>
<p>CUDA is not optional</p>
<div class="fragment"><div class="line">project(MY_PROJECT LANGUAGES CUDA CXX)</div>
</div><!-- fragment --><p>CUDA is optional</p>
<div class="fragment"><div class="line">enable_language(CUDA)</div>
</div><!-- fragment --><p>Check whether CUDA is available</p>
<div class="fragment"><div class="line">include(CheckLanguage)</div>
<div class="line">check_language(CUDA)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md38"></a>
CUDA Variables</h3>
<p>Exchange <em>CXX</em> with <em>CUDA</em></p>
<p>E.g. setting CUDA standard:</p>
<div class="fragment"><div class="line">if(NOT DEFINED CMAKE_CUDA_STANDARD)</div>
<div class="line">    set(CMAKE_CUDA_STANDARD 11)</div>
<div class="line">    set(CMAKE_CUDA_STANDARD_REQUIRED ON)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md39"></a>
Adding libraries / executables</h3>
<p>As long as *.cu* is used for CUDA files, the procedure is as normal.</p>
<p>With separable compilation</p>
<div class="fragment"><div class="line">set_target_properties(mylib PROPERTIES</div>
<div class="line">                            CUDA_SEPARABLE_COMPILATION ON)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md40"></a>
Architecture</h3>
<p>Use <code>CMAKE_CUDA_ARCHITECTURES</code> variable and the <code>CUDA_ARCHITECTURES property</code> on targets.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Working with targets</h3>
<p>Compiler option</p>
<div class="fragment"><div class="line">&quot;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CXX&gt;&gt;:-fopenmp&gt;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CUDA&gt;&gt;:-Xcompiler=-fopenmp&gt;&quot;</div>
</div><!-- fragment --><p>Use a function that will fix a C++ only target by wrapping the flags if using a CUDA compiler</p>
<div class="fragment"><div class="line">function(CUDA_CONVERT_FLAGS EXISTING_TARGET)</div>
<div class="line">    get_property(old_flags TARGET ${EXISTING_TARGET} PROPERTY INTERFACE_COMPILE_OPTIONS)</div>
<div class="line">    if(NOT &quot;${old_flags}&quot; STREQUAL &quot;&quot;)</div>
<div class="line">        string(REPLACE &quot;;&quot; &quot;,&quot; CUDA_flags &quot;${old_flags}&quot;)</div>
<div class="line">        set_property(TARGET ${EXISTING_TARGET} PROPERTY INTERFACE_COMPILE_OPTIONS</div>
<div class="line">            &quot;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CXX&gt;&gt;:${old_flags}&gt;$&lt;$&lt;BUILD_INTERFACE:$&lt;COMPILE_LANGUAGE:CUDA&gt;&gt;:-Xcompiler=${CUDA_flags}&gt;&quot;</div>
<div class="line">            )</div>
<div class="line">    endif()</div>
<div class="line">endfunction()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md42"></a>
Useful variables</h3>
<ul>
<li><code>CMAKE_CUDA_TOOLKIT_INCLUDE_DIRECTORIES</code>: Place for built-in Thrust, etc</li>
<li><code>CMAKE_CUDA_COMPILER</code>: NVCC with location</li>
</ul>
<div class="fragment"><div class="line">set(CUDA_DIR &quot;/usr/local/cuda-10.0&quot;)</div>
<div class="line">set(CMAKE_CUDA_COMPILER ${CUDA_DIR}/bin/nvcc)</div>
<div class="line">set(CMAKE_CUDA_FLAGS &quot;-ccbin ${CC} -x cu -c -dc -O3  -Xcompiler &quot;-O3 -pthread&quot; -Wno-deprecated-gpu-targets -DVERSION=\&quot;${GIT_VERSION}\&quot;  --ptxas-options=-v&quot;)</div>
<div class="line">set(CMAKE_CUDA_FLAGS_DEBUG ...)</div>
<div class="line">set(CMAKE_CUDA_HOST_COMPILER ...)</div>
<div class="line">set(CMAKE_CUDA_EXTENSIONS ...)</div>
<div class="line">set(CMAKE_CUDA_STANDARD ...)</div>
<div class="line">set(CMAKE_CUDA_RUNTIME_LIBRARY ...)</div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md43"></a>
OpenMP</h2>
<h3><a class="anchor" id="autotoc_md44"></a>
Enable OpenMP support</h3>
<div class="fragment"><div class="line">find_package(OpenMP)</div>
<div class="line">if(OpenMP_CXX_FOUND)</div>
<div class="line">    target_link_libraries(MyTarget PUBLIC OpenMP::OpenMP_CXX)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md45"></a>
Boost</h2>
<p>The Boost library is included in the find packages that CMake provides.</p>
<p>(Common) Settings related to boost</p>
<ul>
<li><code>set(Boost_USE_STATIC_LIBS OFF)</code></li>
<li><code>set(Boost_USE_MULTITHREADED ON)</code></li>
<li>`<code>set(Boost_USE_STATIC_RUNTIME OFF)</code></li>
</ul>
<p>E.g.: using the <code>Boost::filesystem</code> library</p>
<div class="fragment"><div class="line">set(Boost_USE_STATIC_LIBS OFF)</div>
<div class="line">set(Boost_USE_MULTITHREADED ON)</div>
<div class="line">set(Boost_USE_STATIC_RUNTIME OFF)</div>
<div class="line">find_package(Boost 1.50 REQUIRED COMPONENTS filesystem)</div>
<div class="line">message(STATUS &quot;Boost version: ${Boost_VERSION}&quot;)</div>
<div class="line"> </div>
<div class="line"># This is needed if your Boost version is newer than your CMake version</div>
<div class="line"># or if you have an old version of CMake (&lt;3.5)</div>
<div class="line">if(NOT TARGET Boost::filesystem)</div>
<div class="line">    add_library(Boost::filesystem IMPORTED INTERFACE)</div>
<div class="line">    set_property(TARGET Boost::filesystem PROPERTY</div>
<div class="line">        INTERFACE_INCLUDE_DIRECTORIES ${Boost_INCLUDE_DIR})</div>
<div class="line">    set_property(TARGET Boost::filesystem PROPERTY</div>
<div class="line">        INTERFACE_LINK_LIBRARIES ${Boost_LIBRARIES})</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
MPI</h2>
<h3><a class="anchor" id="autotoc_md47"></a>
Enable MPI support</h3>
<div class="fragment"><div class="line">find_package(MPI REQUIRED)</div>
<div class="line">message(STATUS &quot;Run: ${MPIEXEC} ${MPIEXEC_NUMPROC_FLAG} ${MPIEXEC_MAX_NUMPROCS} ${MPIEXEC_PREFLAGS} EXECUTABLE ${MPIEXEC_POSTFLAGS} ARGS&quot;)</div>
<div class="line">target_link_libraries(MyTarget PUBLIC MPI::MPI_CXX)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md48"></a>
Adding features</h1>
<h2><a class="anchor" id="autotoc_md49"></a>
Set default build type</h2>
<div class="fragment"><div class="line">set(default_build_type &quot;Release&quot;)</div>
<div class="line">if(NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)</div>
<div class="line">  message(STATUS &quot;Setting build type to &#39;${default_build_type}&#39; as none was specified.&quot;)</div>
<div class="line">  set(CMAKE_BUILD_TYPE &quot;${default_build_type}&quot; CACHE</div>
<div class="line">      STRING &quot;Choose the type of build.&quot; FORCE)</div>
<div class="line">  # Set the possible values of build type for cmake-gui</div>
<div class="line">  set_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS</div>
<div class="line">    &quot;Debug&quot; &quot;Release&quot; &quot;MinSizeRel&quot; &quot;RelWithDebInfo&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md50"></a>
Meta compiler features</h2>
<div class="fragment"><div class="line">target_compile_features(myTarget PUBLIC cxx_std_11)</div>
<div class="line">set_target_properties(myTarget PROPERTIES CXX_EXTENSIONS OFF)</div>
<div class="line">set(CMAKE_CXX_STANDARD 11)</div>
<div class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</div>
<div class="line">set(CMAKE_CXX_EXTENSIONS OFF)</div>
<div class="line">set_target_properties(myTarget PROPERTIES</div>
<div class="line">    CXX_STANDARD 11</div>
<div class="line">    CXX_STANDARD_REQUIRED YES</div>
<div class="line">    CXX_EXTENSIONS NO</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md51"></a>
Position independent code (-fPIC)</h2>
<div class="fragment"><div class="line">set(CMAKE_POSITION_INDEPENDENT_CODE ON)</div>
<div class="line"># or target dependent</div>
<div class="line">set_target_properties(lib1 PROPERTIES POSITION_INDEPENDENT_CODE ON)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md52"></a>
Little libraries</h2>
<div class="fragment"><div class="line">find_library(MATH_LIBRARY m)</div>
<div class="line">if(MATH_LIBRARY)</div>
<div class="line">    target_link_libraries(MyTarget PUBLIC ${MATH_LIBRARY})</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
Modules</h2>
<h3><a class="anchor" id="autotoc_md54"></a>
CMakeDependentOption</h3>
<div class="fragment"><div class="line">include(CMakeDependentOption)</div>
<div class="line">cmake_dependent_option(BUILD_TESTS &quot;Build your tests&quot; ON &quot;VAL1;VAL2&quot; OFF)</div>
</div><!-- fragment --><p>which is equivalent to</p>
<div class="fragment"><div class="line">if(VAL1 AND VAL2)</div>
<div class="line">    set(BUILD_TESTS_DEFAULT ON)</div>
<div class="line">else()</div>
<div class="line">    set(BUILD_TESTS_DEFAULT OFF)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">option(BUILD_TESTS &quot;Build your tests&quot; ${BUILD_TESTS_DEFAULT})</div>
<div class="line"> </div>
<div class="line">if(NOT BUILD_TESTS_DEFAULT)</div>
<div class="line">    mark_as_advanced(BUILD_TESTS)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md55"></a>
CMakePrintHelpers</h3>
<div class="fragment"><div class="line">cmake_print_properties</div>
<div class="line">cmake_print_variables</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md56"></a>
CheckCXXCompilerFlag</h3>
<p>Check whether flag is supported</p>
<div class="fragment"><div class="line">include(CheckCXXCompilerFlag)</div>
<div class="line">check_cxx_compiler_flag(-someflag OUTPUT_VARIABLE)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md57"></a>
WriteCompilerDetectionHeader</h3>
<p>Look for a list of features that some compilers support and write out a C++ header file that lets you know whether that feature is available</p>
<div class="fragment"><div class="line">write_compiler_detection_header(</div>
<div class="line">  FILE myoutput.h</div>
<div class="line">  PREFIX My</div>
<div class="line">  COMPILERS GNU Clang MSVC Intel</div>
<div class="line">  FEATURES cxx_variadic_templates</div>
<div class="line">)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md58"></a>
try_compile / try_run</h3>
<div class="fragment"><div class="line">try_compile(</div>
<div class="line">  RESULT_VAR</div>
<div class="line">    bindir</div>
<div class="line">  SOURCES</div>
<div class="line">    source.cpp</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md59"></a>
Debugging</h1>
<h2><a class="anchor" id="autotoc_md60"></a>
Printing variables</h2>
<div class="fragment"><div class="line">message(STATUS &quot;MY_VARIABLE=${MY_VARIABLE}&quot;)</div>
<div class="line"># or using module </div>
<div class="line">include(CMakePrintHelpers)</div>
<div class="line">cmake_print_variables(MY_VARIABLE)</div>
<div class="line">cmake_print_properties(</div>
<div class="line">    TARGETS my_target</div>
<div class="line">    PROPERTIES POSITION_INDEPENDENT_CODE</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
Tracing a run</h2>
<div class="fragment"><div class="line">cmake -S . -B build --trace-source=CMakeLists.txt #--trace-expand </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md62"></a>
Including projects</h1>
<h2><a class="anchor" id="autotoc_md63"></a>
Fetch</h2>
<p>E.g.: download Catch2</p>
<div class="fragment"><div class="line">FetchContent_Declare(</div>
<div class="line">  catch</div>
<div class="line">  GIT_REPOSITORY https://github.com/catchorg/Catch2.git</div>
<div class="line">  GIT_TAG        v2.13.0</div>
<div class="line">)</div>
<div class="line"># CMake 3.14+</div>
<div class="line">FetchContent_MakeAvailable(catch)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md64"></a>
Testing</h1>
<h2><a class="anchor" id="autotoc_md65"></a>
General</h2>
<p>Enable testing and set a <code>BUILD_TESTING</code> option</p>
<div class="fragment"><div class="line">if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME)</div>
<div class="line">    include(CTest)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>Add test folder</p>
<div class="fragment"><div class="line">if(CMAKE_PROJECT_NAME STREQUAL PROJECT_NAME AND BUILD_TESTING)</div>
<div class="line">    add_subdirectory(tests)</div>
<div class="line">endif()</div>
</div><!-- fragment --><p>Register targets</p>
<div class="fragment"><div class="line">add_test(NAME TestName COMMAND TargetName)</div>
<div class="line">add_test(NAME TestName COMMAND $&lt;TARGET_FILE:${TESTNAME}&gt;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md66"></a>
Building as part of the test</h2>
<div class="fragment"><div class="line">add_test(</div>
<div class="line">  NAME</div>
<div class="line">    ExampleCMakeBuild</div>
<div class="line">  COMMAND</div>
<div class="line">    &quot;${CMAKE_CTEST_COMMAND}&quot;</div>
<div class="line">             --build-and-test &quot;${My_SOURCE_DIR}/examples/simple&quot;</div>
<div class="line">                              &quot;${CMAKE_CURRENT_BINARY_DIR}/simple&quot;</div>
<div class="line">             --build-generator &quot;${CMAKE_GENERATOR}&quot;</div>
<div class="line">             --test-command &quot;${CMAKE_CTEST_COMMAND}&quot;</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
Testing frameworks</h2>
<h3><a class="anchor" id="autotoc_md68"></a>
GoogleTest</h3>
<p>See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/testing/googletest.html">Modern CMake: GoogleTest</a> for reference.</p>
<p>Checkout GoogleTest as submodule</p>
<div class="fragment"><div class="line">git submodule add --branch=release-1.8.0 ../../google/googletest.git extern/googletest</div>
</div><!-- fragment --><div class="fragment"><div class="line">option(PACKAGE_TESTS &quot;Build the tests&quot; ON)</div>
<div class="line">if(PACKAGE_TESTS)</div>
<div class="line">    enable_testing()</div>
<div class="line">    include(GoogleTest)</div>
<div class="line">    add_subdirectory(tests)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md69"></a>
Catch2</h3>
<div class="fragment"><div class="line"># Prepare &quot;Catch&quot; library for other executables</div>
<div class="line">set(CATCH_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/extern/catch)</div>
<div class="line">add_library(Catch2::Catch IMPORTED INTERFACE)</div>
<div class="line">set_property(Catch2::Catch PROPERTY INTERFACE_INCLUDE_DIRECTORIES &quot;${CATCH_INCLUDE_DIR}&quot;)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
DocTest</h3>
<p><em>DocTest</em> is a replacement for <em>Catch2</em> that is supposed to compile much faster and be cleaner. Just replace <em>Catch2</em> with <em>DocTest</em>.</p>
<h1><a class="anchor" id="autotoc_md71"></a>
Exporting and Installing</h1>
<p>Allow others to use your library, via</p>
<ul>
<li><em>Bad way:</em> Find module</li>
<li><em>Add subproject:</em> <code>add_library(MyLib::MyLib ALIAS MyLib)</code></li>
<li><em>Exporting:</em> Using *Config.cmake scripts</li>
</ul>
<h2><a class="anchor" id="autotoc_md72"></a>
Installing</h2>
<p>See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/installing.html">GitBook: Installing</a> Basic target install command (executed by e.g. <code>make install</code>)</p>
<div class="fragment"><div class="line">install(TARGETS MyLib</div>
<div class="line">        EXPORT MyLibTargets</div>
<div class="line">        LIBRARY DESTINATION lib</div>
<div class="line">        ARCHIVE DESTINATION lib</div>
<div class="line">        RUNTIME DESTINATION bin</div>
<div class="line">        INCLUDES DESTINATION include</div>
<div class="line">        )</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md73"></a>
Exporting</h2>
<p>See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/exporting.html">GitBook: Exporting</a></p>
<h2><a class="anchor" id="autotoc_md74"></a>
Packaging</h2>
<p>See <a href="https://cliutils.gitlab.io/modern-cmake/chapters/install/packaging.html">GitBook: Packaging</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    Cpp concept project  - CMake<br />
    Generated on Mon Dec 7 2020 21:42:38 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.20
  </small></address>
</body>
</html>